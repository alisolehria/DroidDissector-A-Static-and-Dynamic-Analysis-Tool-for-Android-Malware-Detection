
import re
from androguard.misc import AnalyzeAPK
from bs4 import BeautifulSoup



def get_intents(soup):
    # intent
    all_intents = soup.find_all(name='action')
    intents = set()
    for intent in all_intents:
        if intent.has_attr('android:name'):
            intents.add(intent['android:name'])


    return intents


def get_components(APK):
    # activity
    components = [r'activity', r'service', r'provider', r'receiver']
    components = set()
    components = {}


    components['activity'] = set(APK.get_activities())
    components['service'] = set(APK.get_receivers())
    components['provider'] = set(APK.get_services())
    components['receiver'] = set(APK.get_providers())
    
    return components





def get_manifest_fetures(axml,apkfile):
    
    soup = BeautifulSoup(axml, 'html.parser')
    
    APK, d, dx = AnalyzeAPK(apkfile)
    required_permissions = set(APK.permissions)
    hardware_components = set(APK.get_features())

    intents = get_intents(soup)
    components = get_components(APK)
    
    return required_permissions, hardware_components, intents, components



